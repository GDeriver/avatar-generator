<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>2025ç”Ÿæ—¥åº”æ´ä¹‹æˆ‘ä¸GDçš„ç‰¹åˆ«å°è®°</title>
<style>
  :root{--bg:#f7f7f7;--card:#fff;--accent:#ff3b30}


  :root {
  --bg: #e0f1ff;
  /* --card: #daf5ff; */
  --card: #feeffd;
  --accent: #42b6f9; /* #ffd2fe */
  }
  body {
    color: #012854;
  }

  body{font-family: Arial,"Helvetica Neue",Helvetica,sans-serif;background:var(--bg);margin:0;padding:24px;display:flex;align-items:flex-start;justify-content:center;min-height:100vh}
  .wrap{width:980px;max-width:95%;background:var(--card);padding:20px;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,0.08)}

/*   .wrap {
  border: 3px solid transparent;
  border-image: linear-gradient(45deg, #fdc9ff, #94d0f8) 1;
  } */

/*   body {
    background: url('images/bg3.jpg') no-repeat center center fixed;
    background-size: cover;
  } */

  .falling {
    color: pink; /* è‡ªå®šä¹‰ä¸‹è½é¢œè‰² */
  }
  #orderId {
    width: 300px;
  }
  #nickname {
    width: 300px;
  }

  h1{margin:0 0 10px;font-size:20px}
  .row{display:flex;gap:12px;align-items:center;margin-top:8px}
  input[type="text"], input[type="file"]{padding:8px 10px;font-size:15px;border:1px solid #dddddd;border-radius:6px}
  button{padding:8px 12px;border-radius:6px;border:0;background:var(--accent);color:#fff;cursor:pointer}
  #canvas{border:1px solid #e2e2e2;margin-top:14px;max-width:100%}
  @font-face{
    font-family:'MyFontCN';
    src: url('fonts/MyFontCN4.ttf') format('truetype');
  }
  @font-face{
    font-family:'MyFontEN';
    src: url('fonts/MyFontEN2.ttf') format('truetype');
  }
</style>
</head>
<body>

<img src="images/banner.png" alt="banner" style="max-width:20%; border-radius:12px; margin-bottom:20px;">



<div class="wrap">
    <h1>â™¥æˆ‘ä¸G-Dragonçš„ç‰¹åˆ«å°è®°â™¥</h1>
    <p class="note">æ­¥éª¤ï¼šè¾“å…¥è®¢å•å·æŸ¥è¯¢ä¸“å±ç”Ÿæ—¥åº”æ´ç¼–å· â†’ æŸ¥è¯¢æˆåŠŸåè¾“å…¥æ˜µç§° â†’ å®æ—¶é¢„è§ˆ â†’ ä¸‹è½½PNGã€‚</p>

    <div id="step1">
      <p><strong>1. æŸ¥è¯¢æˆ‘çš„GDç”Ÿæ—¥åº”æ´ç¼–å·ï¼š</strong></p>
      <div class="row">
        <input id="orderId" type="text" placeholder="è¾“å…¥ç¤¼åŒ…çš„è®¢å•å·å“ŸÎ¾( âœ¿ï¼â—¡â›)" />
        <button id="checkBtn">æŸ¥è¯¢æˆ‘çš„ç¼–å·</button>
      </div>
      <p class="small">æ³¨ï¼šè®¢å•å·æ¥è‡ª2025åŒåŸåº”æ´ç¤¼åŒ…è´­ä¹°è®°å½•ã€‚</p>
    </div>

    <div id="step2" style="display:none;margin-top:10px;">
      <p><strong>2. è¾“å…¥æ˜µç§°ï¼š</strong></p>
      <div class="row">
        <input id="nickname" type="text" placeholder="12å­—ç¬¦ä»¥å†…çš„ä¸­è‹±æ–‡æˆ–æ•°å­—âœ§*ï½¡Ù©(ËŠá—œË‹*)Ùˆâœ§*ï½¡" maxlength="12" />
        <button id="genBtn">ç”Ÿæˆå¹¶æ˜¾ç¤ºé¢„è§ˆ</button>
        <button id="downloadBtn" style="display:none;background:#333">ä¸‹è½½PNG</button>
      </div>
<!--       <div class="row">
        <label>ä¸Šä¼ è´´çº¸ï¼ˆå¯é€‰ï¼‰ï¼š</label>
        <input type="file" id="uploadSticker" accept="image/png, image/jpeg">
      </div> -->
      <p class="small">å¦‚æœæƒ³åœ¨è¾“å…¥è¿‡ç¨‹ä¸­å®æ—¶çœ‹åˆ°æ•ˆæœï¼Œè¯·ç›´æ¥åœ¨è¾“å…¥æ¡†è¾“å…¥ï¼Œé¢„è§ˆä¼šè‡ªåŠ¨æ›´æ–°ã€‚</p>
    </div>



    <div id="previewBox">
      <div class="left">
        <canvas id="canvas" width="1080" height="1080" style="display:none"></canvas>
      </div>
      <div class="right">
        <div id="info" style="font-size:14px;color:#444">
          <p>æˆ‘çš„ç¼–å·ï¼š<span id="currentNumber">â€”</span></p>
          <p>æ–‡ä»¶ä¸‹è½½ç¤ºä¾‹ï¼š<span id="filenameExample">â€”</span></p>
          <!-- <p class="small">è°ƒæ•´ï¼šè¦æ”¹å˜åºå·/æ˜µç§°åœ¨å›¾ä¸Šçš„ä½ç½®æˆ–æ ·å¼ï¼Œè¯·ç¼–è¾‘ <code>index.html</code> å†…çš„ <code>numberPos</code>ã€<code>namePos</code> å’Œå­—ä½“è®¾ç½®ã€‚</p> -->
        </div>
      </div>
    </div>

</div>

<canvas id="canvas" style="max-width: 800px; height: auto;"></canvas>

<script>
(async ()=> {
  // ---------- é…ç½® ----------
/*   const canvasSize = { w:5906, h:7087 };
  const numberPos = { x: 3800, y: 5900, font: '450px MyFontEN', color: '#FFFFFF' };
  //const namePos   = { x: 1790, y: 4700, font: ' 300px MyFontCN', color: '#FFFFFF' };
  const namePos   = { x: 1990, y: 5150, font: ' 300px MyFontCN', color: '#FFFFFF' };
/*   const numberPos = { x: 200, y: 5240, font: '450px MyFontEN', color: '#FFFFFF' };
  const namePos   = { x: 4590, y: 5600, font: ' 300px MyFontCN', color: '#FFFFFF' }; 1920 5200*/ 

  const canvasSize = { w: 2000, h: 2400 };  // ç¼©å°ç‰ˆ
  const numberPos = { x: 1280, y: 2000, font: '150px MyFontEN', color: '#FFFFFF' };
  const namePos   = { x: 670,  y: 1745, font: '100px MyFontCN', color: '#FFFFFF' };


  const allowedNameRegex = /^[\u4e00-\u9fa5A-Za-z0-9]+$/;

  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');

  // ---------- è´´çº¸ç›¸å…³ ----------
  let stickerImg = null;
  let stickerX = 350, stickerY = 50, stickerW = 200, stickerH = 200;
  const resizeHandleSize = 100;
  let dragging = false, resizing = false;
  let dragOffsetX = 0, dragOffsetY = 0;

  // è½½å…¥è®¢å•è¡¨
  let orders = null;
  async function loadOrders() {
    try {
      const resp = await fetch('data/orders.json', {cache: "no-store"});
      if (!resp.ok) throw new Error('fetch fail');
      orders = await resp.json();
    } catch (e) {
      alert('åŠ è½½è®¢å•æ•°æ®å¤±è´¥ï¼Œè¯·ç”¨æœ¬åœ°æœåŠ¡å™¨è¿è¡Œ');
      console.error(e);
    }
  }
  await loadOrders();

  async function waitFonts() {
    if (document.fonts && document.fonts.ready) {
      try { await document.fonts.ready; } catch(e){}
    } else {
      await new Promise(r=>setTimeout(r,300));
    }
  }

  // ç»˜åˆ¶å¤´åƒ
  async function draw(number, name) {
    if (!orders) return;
    await waitFonts();
    return new Promise((resolve,reject)=>{
      const img = new Image();
      img.onload = () => {
        canvas.width = canvasSize.w;
        canvas.height = canvasSize.h;
        ctx.clearRect(0,0,canvas.width,canvas.height);
        ctx.drawImage(img,0,0,canvas.width,canvas.height);
        // åºå·
        ctx.fillStyle = numberPos.color;
        ctx.textAlign = 'left';
        ctx.font = numberPos.font;
        ctx.fillText(`No.${number}`, numberPos.x, numberPos.y);
        // æ˜µç§°
        ctx.fillStyle = namePos.color;
        let nickname = document.getElementById('nickname').value;
/*         if (/^[\u4e00-\u9fa5]+$/.test(nickname)) {
          ctx.font = '240px MyFontCN';
        } else {
          ctx.font = '220px MyFontCN';
        }  */

        if (/^[\u4e00-\u9fa5]+$/.test(nickname)) {
          ctx.font = '80px MyFontCN';
        } else {
          ctx.font = '73px MyFontCN';
        } 
        ctx.textAlign = 'right';
        //ctx.font = '240px MyFontCN';
        ctx.fillText(`ã€Œ${name}ã€`, namePos.x, namePos.y);
        //ctx.fillText(`${name}`, namePos.x, namePos.y);
        // ç»˜åˆ¶è´´çº¸
        if (stickerImg) {
          ctx.drawImage(stickerImg, stickerX, stickerY, stickerW, stickerH);
          // ç»˜åˆ¶ç¼©æ”¾æ‰‹æŸ„
          ctx.fillStyle = 'rgba(0,0,0,0.5)';
          ctx.fillRect(stickerX + stickerW - resizeHandleSize/2,
                       stickerY + stickerH - resizeHandleSize/2,
                       resizeHandleSize, resizeHandleSize);
        }
        canvas.style.display = 'block';
        resolve();
      };
      img.onerror = reject;
      img.src = 'images/template7.png';
    });
  }

  // å…ƒç´ 
  const orderInput = document.getElementById('orderId');
  const checkBtn = document.getElementById('checkBtn');
  const step2 = document.getElementById('step2');
  const nicknameInput = document.getElementById('nickname');
  const genBtn = document.getElementById('genBtn');
  const downBtn = document.getElementById('downloadBtn');
  const currentNumberSpan = document.getElementById('currentNumber');
  const filenameExample = document.getElementById('filenameExample');
  const uploadSticker = document.getElementById('uploadSticker');

  let currentNumber = null;

  checkBtn.addEventListener('click', ()=>{
    const id = (orderInput.value||'').trim();
    if (!id) { alert('è¯·è¾“å…¥è®¢å•å·'); return; }
    if (!orders) { alert('è®¢å•æ•°æ®æœªåŠ è½½'); return; }
    if (!orders[id]) { alert('æœªæ‰¾åˆ°è¯¥è®¢å•å·'); return; }
    currentNumber = orders[id];
    currentNumberSpan.textContent = currentNumber;
    filenameExample.textContent = `No_${currentNumber}_ä½ çš„æ˜µç§°.png`;
    step2.style.display = 'block';
    nicknameInput.focus();
    draw(currentNumber, nicknameInput.value || 'æ˜µç§°');
  });

  nicknameInput.addEventListener('input', async ()=>{
    const name = nicknameInput.value.trim();
    if (!currentNumber) return;
    await draw(currentNumber, name || 'æ˜µç§°');
  });

  genBtn.addEventListener('click', async ()=>{
    const name = nicknameInput.value.trim();
    if (!currentNumber) { alert('è¯·å…ˆæ ¡éªŒè®¢å•å·'); return; }
    if (!name) { alert('è¯·è¾“å…¥æ˜µç§°'); return; }
    if (!allowedNameRegex.test(name)) { alert('æ˜µç§°åªèƒ½å«ä¸­/è‹±/æ•°å­—'); return; }
    await draw(currentNumber, name);
    downBtn.style.display = 'inline-block';
    filenameExample.textContent = `No_${currentNumber}_${name}.png`;
  });

  downBtn.addEventListener('click', ()=>{
    const name = nicknameInput.value.trim() || 'æ˜µç§°';
    const link = document.createElement('a');
    const safeName = name.replace(/[^a-zA-Z0-9\u4e00-\u9fa5]/g,'_');
    link.download = `No_${currentNumber}_${safeName}.png`;
    link.href = canvas.toDataURL('image/png');
    link.click();
  });

  // ä¸Šä¼ è´´çº¸
  uploadSticker.addEventListener('change', e=>{
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = ev=>{
        stickerImg = new Image();
        stickerImg.onload = ()=> draw(currentNumber, nicknameInput.value || 'æ˜µç§°');
        stickerImg.src = ev.target.result;
        // åˆå§‹ä½ç½®å¤§å°
        stickerX = 500; stickerY = 500; stickerW = 600; stickerH = 600;
      };
      reader.readAsDataURL(file);
    }
  });

  // è´´çº¸æ‹–æ‹½ç¼©æ”¾äº‹ä»¶
  function isOnSticker(mx, my) {
    return mx >= stickerX && mx <= stickerX+stickerW && my >= stickerY && my <= stickerY+stickerH;
  }
  function isOnResizeHandle(mx,my) {
    return mx >= stickerX+stickerW-resizeHandleSize &&
           mx <= stickerX+stickerW+resizeHandleSize &&
           my >= stickerY+stickerH-resizeHandleSize &&
           my <= stickerY+stickerH+resizeHandleSize;
  }
  canvas.addEventListener('mousedown', e=>{
    if (!stickerImg) return;
    const rect = canvas.getBoundingClientRect();
    const mx = e.clientX - rect.left;
    const my = e.clientY - rect.top;
    if (isOnResizeHandle(mx,my)) {
      resizing = true;
    } else if (isOnSticker(mx,my)) {
      dragging = true;
      dragOffsetX = mx - stickerX;
      dragOffsetY = my - stickerY;
    }
  });
  canvas.addEventListener('mousemove', e=>{
    if (!stickerImg) return;
    const rect = canvas.getBoundingClientRect();
    const mx = e.clientX - rect.left;
    const my = e.clientY - rect.top;
    if (dragging) {
      stickerX = mx - dragOffsetX;
      stickerY = my - dragOffsetY;
      draw(currentNumber, nicknameInput.value || 'æ˜µç§°');
    } else if (resizing) {
      stickerW = Math.max(20, mx - stickerX);
      stickerH = Math.max(20, my - stickerY);
      draw(currentNumber, nicknameInput.value || 'æ˜µç§°');
    }
  });
  canvas.addEventListener('mouseup', ()=>{
    dragging = false;
    resizing = false;
  });
  canvas.addEventListener('mouseleave', ()=>{
    dragging = false;
    resizing = false;
  });

})();
</script>
<!-- 
<style>
  .falling {
    position: fixed;
    top: -50px;
    pointer-events: none;
    will-change: transform;
    user-select: none;
  }
</style>

<script>
  function createFallingEmoji() {
    const emoji = ["ğŸŒ¸","â€","âœ¿","â¤","ğŸ’•","ğŸŒ¹","ğŸ’—","ğŸ’","ğŸŒ¼","ğŸ‰","ğŸŠ","ğŸˆ","ğŸ","ğŸ€","ğŸ‚","ğŸ°","ğŸŒŸ","â­","ğŸ’«"]; 
    const images = ["images/fall.png", "images/fall.png", "images/fall2.png", "images/fall3.png", "images/fall4.png", "images/fall5.png", "images/fall6.png", "images/fall7.png"];

    const el = document.createElement("div");
    el.className = "falling";

    // éšæœºé€‰æ‹©emojiæˆ–å›¾ç‰‡
    if (Math.random() < 0.3) {
      const img = document.createElement("img");
      img.src = images[Math.floor(Math.random() * images.length)];
      img.style.width = (20 + Math.random() * 30) + "px";
      el.appendChild(img);
    } else {
      el.innerText = emoji[Math.floor(Math.random() * emoji.length)];
      el.style.fontSize = (10 + Math.random() * 20) + "px";
    }

    // åˆå§‹ä½ç½®
    el.style.left = Math.random() * window.innerWidth + "px";
    el.style.top = "-50px";
    document.body.appendChild(el);

    // æ¨¡æ‹Ÿè‡ªç”±è½ä½“
    let pos = -50;
    const ground = window.innerHeight - 50 - Math.random() * 30; // éšæœºé«˜åº¦ï¼Œé¿å…å…¨éƒ½ä¸€æ’
    const speed = 2 + Math.random() * 3; // ä¸‹è½é€Ÿåº¦
    const timer = setInterval(() => {
      pos += speed;
      if (pos >= ground) {
        pos = ground;
        el.style.top = pos + "px";
        clearInterval(timer);

        // åœç•™ä¸€ä¼šå„¿å†æ¶ˆå¤±
        setTimeout(() => {
          el.style.transition = "opacity 1s";
          el.style.opacity = 0;
          setTimeout(() => el.remove(), 1000);
        }, 4000); // 4ç§’åæ¶ˆå¤±
      } else {
        el.style.top = pos + "px";
      }
    }, 20);
  }

  // æ¯éš”300msç”Ÿæˆä¸€ä¸ª
  setInterval(createFallingEmoji, 300);
</script> -->


<style>
  .falling {
    position: fixed;
    top: -50px;
    animation: fall linear forwards;
    pointer-events: none;
  }

  @keyframes fall {
    to {
      transform: translateY(110vh) rotate(360deg);
      opacity: 0.8;
    }
  }
</style>

<script>
  function createFallingEmoji() {
    const emoji = ["ğŸŒ¸","â€","âœ¿","â¤","ğŸ’•","ğŸŒ¹","ğŸ’—","ğŸ’","ğŸŒ¼","ğŸ‰","ğŸŠ","ğŸˆ","ğŸ","ğŸ€","ğŸ‚","ğŸ°","ğŸŒŸ","â­","ğŸ’«"]; 
    const images = ["images/fall.png", "images/fall.png", "images/fall.png", "images/fall.png", "images/fall2.png", "images/fall3.png", "images/fall4.png", "images/fall5.png", "images/fall6.png", "images/fall7.png"]; // ä½ çš„ PNG è·¯å¾„ï¼Œå¯ä»¥æ”¾å¤šä¸ª

    const el = document.createElement("div");
    el.className = "falling";

    if (Math.random() < 0.5) {
      // 30% æ¦‚ç‡ç”¨ PNG
      const img = document.createElement("img");
      img.src = images[Math.floor(Math.random() * images.length)];
      img.style.width = (20 + Math.random() * 30) + "px"; // éšæœºå¤§å°
      el.appendChild(img);
    } else {
      // 70% æ¦‚ç‡ç”¨ emoji
      el.innerText = emoji[Math.floor(Math.random() * emoji.length)];
      el.style.fontSize = (10 + Math.random() * 20) + "px";
    }

    // éšæœºä½ç½® & åŠ¨ç”»æ—¶é•¿
    el.style.left = Math.random() * window.innerWidth + "px";
    el.style.animationDuration = (6 + Math.random() * 5) + "s";

    document.body.appendChild(el);

    // åŠ¨ç”»ç»“æŸåæ¸…ç†å…ƒç´ 
    setTimeout(() => el.remove(), 10000);
  }

  // æ¯éš”300msç”Ÿæˆä¸€ä¸ª
  setInterval(createFallingEmoji, 100);
</script> 


<!-- <style>
  .falling {
    position: fixed;
    top: -50px;
    font-size: 24px;
    animation: fall linear forwards;
    pointer-events: none;
  }

  @keyframes fall {
    to {
      transform: translateY(110vh) rotate(360deg);
      opacity: 0.8;
    }
  }
</style>

<script>
  function createFallingEmoji() {
    const emoji = ["ğŸŒ¸","â€","âœ¿","â¤","ğŸ’•","ğŸŒ¹","ğŸ’—","ğŸ’","ğŸŒ¼","ğŸ‰","ğŸŠ","ğŸˆ","ğŸ","ğŸ€","ğŸ‚","ğŸ°","ğŸŒŸ","â­","ğŸ’«"]; 
    //  "â¤","â˜…","âœ¨" ,"ğŸ‰","ğŸŠ","ğŸˆ","ğŸ","ğŸ€","ğŸ‚","ğŸ§","ğŸ©","ğŸ®","ğŸ°","ğŸŒŸ","â­","ğŸ’«",""
    // 
    const el = document.createElement("div");
    el.className = "falling";
    el.innerText = emoji[Math.floor(Math.random() * emoji.length)];
    
    // éšæœºä½ç½®/å¤§å°/åŠ¨ç”»æ—¶é•¿
    el.style.left = Math.random() * window.innerWidth + "px";
    el.style.fontSize = (10 + Math.random() * 20) + "px";
    el.style.animationDuration = (6 + Math.random() * 5) + "s";
    
    document.body.appendChild(el);
    
    // åŠ¨ç”»ç»“æŸåæ¸…ç†å…ƒç´ 
    setTimeout(() => {
      el.remove();
    }, 10000);
  }

  // æ¯éš”300msç”Ÿæˆä¸€ä¸ª
  setInterval(createFallingEmoji, 300);
 -->

</script>
</body>
</html>


<footer style="
  position: fixed;   /* å›ºå®šåœ¨é¡µé¢åº•éƒ¨ */
  bottom: 0;         /* åº•éƒ¨å¯¹é½ */
  left: 0;           /* å·¦è¾¹ç•Œå¯¹é½ */
  width: 100%;       /* å æ»¡æ•´ä¸ªå®½åº¦ */
  text-align: center;
  padding: 10px 0;
  font-size: 15px;
  color: #696969;
  line-height: 2;
  background: rgba(255, 239, 250, 0.8); /* å¯é€‰ï¼šåŠé€æ˜èƒŒæ™¯ */
  z-index: 1000;     /* ç¡®ä¿è¦†ç›–åœ¨åŠ¨ç”»ä¸Šé¢ */
">
  âœ¨ğŸ’ æƒå¿—é¾™ 2025 ç”Ÿæ—¥åº”æ´ Â· æˆ‘å’ŒGDçš„ç‰¹åˆ«å°è®° ğŸ’âœ¨<br>
  â¤ å‡ºå“ï¼šæƒå¿—é¾™_FAMHOME â¤<br>
  ğŸ› ï¸ å¼€å‘ï¼šéœœå­£Gliz ğŸ› ï¸
</footer>

